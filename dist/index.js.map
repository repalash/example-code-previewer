{"version":3,"file":"index.js","sources":["../src/index.js","../src/codepen.js"],"sourcesContent":["import {highlightElement} from 'https://unpkg.com/@speed-highlight/core/dist/index.js';\nimport themeStyles from './../node_modules/@speed-highlight/core/dist/themes/dark.css';\nimport indexStyles from \"./index.css\";\nimport {linkCodepen} from \"./codepen.js\";\n\nexport async function setupCodePreview(container, scripts, titles, sourcePrefix, processor, codepenOpts, appendHTML){\n    const initHTML = container.outerHTML + '\\n' + (appendHTML || '');\n    let sources = []\n    if(!scripts){\n        sources = [document.querySelector('#example-script').textContent, 'js'];\n    }else {\n        sources = await Promise.all(scripts.map(async src => [\n            typeof src==='string' ? (await (await fetch(src)).text()).trim() : src.textContent.trimEnd(),\n            typeof src==='string' ? src.split('?')[0].split('.').pop() : 'js']\n        ));\n    }\n    const previewel = document.createElement('div')\n    previewel.id = 'code-previewer';\n    previewel.innerHTML = `\n        <style>${themeStyles}</style>\n        <style>${indexStyles}</style>\n        <div class=\"show-code-btn\"><></div>\n        <div class=\"code-block fira\">\n\n            <div class=\"code-header code-header-left\">\n                ${titles.map((lang) => `<span>${lang}</span>`).join('&nbsp;')}\n            </div>\n            <div class=\"code-header code-header-center\">\n                <div id=\"code-head-title\">${document.title}</div>\n            </div>\n            <div class=\"code-header code-header-right\">\n                <span id=\"copy-btn\">copy</span>\n                <span id=\"source-btn\">source</span>\n            </div>\n            <div class=\"code-header code-header-right-2\">\n            </div>\n\n            <pre class='shj-lang-js fira shj-multiline code-text'></pre>\n        </div>\n    `\n    container.appendChild(previewel);\n\n    const codeBlock = document.querySelector('.code-block')\n    function updateState(){\n        window && window.localStorage && window.localStorage.setItem('code-block-state', JSON.stringify({\n            open: codeBlock.style.display !== 'none',\n            fileIndex: currentIndex,\n        }))\n    }\n\n    const elem = document.querySelector('.code-text');\n    let currentIndex = 0;\n    function loadScript(title){\n        const last = document.querySelector('.code-header-left > span.active')\n        last && last.classList.remove('active');\n\n        const index = titles.findIndex(a=>a===title);\n        currentIndex = index;\n        const source = sources[index];\n        elem.textContent = source[0]\n        const lang = source[1];\n        elem.classList.remove('shj-lang-'+elem.dataset.lang);\n        elem.classList.add('shj-lang-'+lang);\n        highlightElement(elem);\n        const js = processor ? processor(elem.textContent) : elem.textContent;\n        const head2 = document.querySelector('.code-header-right-2')\n        head2.querySelector('#codepen-form') && head2.querySelector('#codepen-form').remove();\n        if(lang === 'js' || lang === 'ts')\n            head2.innerHTML += linkCodepen({\n                html: initHTML,\n                js: js,\n                js_pre_processor: lang === 'ts' ? 'typescript' : 'none',\n                ...codepenOpts,\n            });\n        const el = document.querySelector('.code-header-left > span:nth-child('+(index+1)+')')\n        el && el.classList.add('active');\n        updateState();\n    }\n\n    document.querySelector('.code-header-left').addEventListener('click', (e) => {\n        if(e.target.tagName === 'SPAN'){\n            loadScript(e.target.textContent);\n        }\n    })\n    document.querySelector('#copy-btn').addEventListener('click', (e) => {\n        navigator.clipboard && navigator.clipboard.writeText(elem.textContent).then(() => {\n            e.target.textContent = 'copied';\n            setTimeout(() => {\n                e.target.textContent = 'copy';\n            }, 1000)\n        })\n    })\n    document.querySelector('#source-btn').addEventListener('click', (e) => {\n        const ind = currentIndex\n        if(ind >=0 && ind<sourcePrefix.length) window.open(sourcePrefix[ind], '_blank');\n    })\n\n    document.querySelector('.show-code-btn').addEventListener('click', (e) => {\n        codeBlock.style.display = codeBlock.style.display === 'none' ? 'block' : 'none';\n        updateState();\n    })\n\n    const localStorageState = window && window.localStorage.getItem('code-block-state');\n    let open_ = false;\n    let index_ = currentIndex;\n    if(localStorageState){\n        const state = JSON.parse(localStorageState);\n        if(state.open !== undefined) open_ = state.open;\n        if(state.fileIndex && state.fileIndex < titles.length) index_ = state.fileIndex;\n    }\n    codeBlock.style.display = open_ ? 'block' : 'none';\n    loadScript(titles[index_]);\n\n    window.addEventListener('beforeunload', () => {\n        updateState();\n    })\n\n    return {\n        close: () => {\n            codeBlock.style.display = 'none';\n            updateState();\n        },\n        open: () => {\n            codeBlock.style.display = 'block';\n            updateState();\n        }\n    }\n\n}\n","// https://blog.codepen.io/documentation/prefill/\nexport function linkCodepen({html, css, js, ...opts}) {\n\n    html = html.trim();\n    css = css.trim();\n    js = js.trim();\n\n    const data = {\n        title: document.title,\n        description: \"\",\n        html: html,\n        html_pre_processor: \"none\",\n        css: css,\n        css_pre_processor: \"none\",\n        css_starter: \"neither\",\n        css_prefix_free: false,\n        js: js,\n        js_pre_processor: 'js',\n        js_modernizr: false,\n        js_library: \"\",\n        html_classes: \"\",\n        css_external: \"\",\n        js_external: \"\",\n        editors: \"101\",\n        template: true,\n        ...opts\n    };\n\n    const JSONstring =\n        JSON.stringify(data)\n            // Quotes will screw up the JSON\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&apos;\");\n\n    const form =\n        '<form id=\"codepen-form\" action=\"https://codepen.io/pen/define\" method=\"POST\" target=\"_blank\">' +\n        '<input type=\"hidden\" name=\"data\" value=\\'' +\n        JSONstring +\n        '\\'>' +\n        '<input type=\"image\" src=\"https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-1/cp-arrow-right.svg\" width=\"35\" height=\"35\" value=\"Create New Pen with Prefilled Data\" class=\"codepen-mover-button\">' +\n        '</form>';\n\n    return form\n}\n"],"names":["async","setupCodePreview","container","scripts","titles","sourcePrefix","processor","codepenOpts","appendHTML","initHTML","outerHTML","sources","Promise","all","map","src","fetch","text","trim","textContent","trimEnd","split","pop","document","querySelector","previewel","createElement","id","innerHTML","lang","join","title","appendChild","codeBlock","updateState","window","localStorage","setItem","JSON","stringify","open","style","display","fileIndex","currentIndex","elem","loadScript","last","classList","remove","index","findIndex","a","source","dataset","add","highlightElement","js","head2","html","css","opts","data","description","html_pre_processor","css_pre_processor","css_starter","css_prefix_free","js_pre_processor","js_modernizr","js_library","html_classes","css_external","js_external","editors","template","replace","linkCodepen","el","addEventListener","e","target","tagName","navigator","clipboard","writeText","then","setTimeout","ind","length","localStorageState","getItem","open_","index_","state","parse","undefined","close"],"mappings":"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"}